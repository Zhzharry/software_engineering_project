# API æ¥å£æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•è¯´æ˜

æœ¬æ–‡æ¡£åŒ…å«æ‰€æœ‰ REST API æ¥å£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åŒ…å«ï¼š
- **è¯·æ±‚è·¯å¾„**ï¼šå®Œæ•´çš„ API ç«¯ç‚¹
- **è¯·æ±‚æ–¹æ³•**ï¼šGET/POST/PUT/DELETE
- **è¯·æ±‚ä½“**ï¼šJSON æ ¼å¼çš„è¯·æ±‚æ•°æ®
- **æ•°æ®åº“éªŒè¯**ï¼šå¦‚ä½•åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹å¯¹åº”çš„å˜åŒ–

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- åŸºç¡€ URL: `http://localhost:8080`
- MySQL æ•°æ®åº“: `zaiqing`
- MongoDB æ•°æ®åº“: `module_db`

---

## 1. ç”¨æˆ·ç®¡ç†æ¥å£ (UserController)

### 1.1 åˆ›å»ºç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `POST /api/users`

**è¯·æ±‚ä½“**:
```json
{
  "username": "testuser001",
  "email": "testuser001@example.com",
  "phone": "13800138001",
  "status": 1
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
-- åœ¨ MySQL ä¸­æŸ¥è¯¢
USE zaiqing;
SELECT * FROM user WHERE username = 'testuser001';

-- éªŒè¯å­—æ®µ
-- id: è‡ªåŠ¨ç”Ÿæˆçš„ID
-- username: 'testuser001'
-- email: 'testuser001@example.com'
-- phone: '13800138001'
-- status: 1
-- create_time: å½“å‰æ—¶é—´ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
-- update_time: å½“å‰æ—¶é—´ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
```

---

### 1.2 æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `GET /api/users/{id}`

**ç¤ºä¾‹**: `GET /api/users/1`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
-- éªŒè¯è¿”å›çš„æ•°æ®ä¸æ•°æ®åº“ä¸€è‡´
SELECT * FROM user WHERE id = 1;
```

---

### 1.3 æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `GET /api/users/username/{username}`

**ç¤ºä¾‹**: `GET /api/users/username/testuser001`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM user WHERE username = 'testuser001';
```

---

### 1.4 æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `GET /api/users`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM user ORDER BY id;
```

---

### 1.5 åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `GET /api/users/page?page=0&size=10&sort=id`

**å‚æ•°è¯´æ˜**:
- `page`: é¡µç ï¼ˆä»0å¼€å§‹ï¼‰
- `size`: æ¯é¡µå¤§å°
- `sort`: æ’åºå­—æ®µ

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM user ORDER BY id LIMIT 0, 10;
```

---

### 1.6 æ›´æ–°ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `PUT /api/users/{id}`

**ç¤ºä¾‹**: `PUT /api/users/1`

**è¯·æ±‚ä½“**:
```json
{
  "username": "testuser001",
  "email": "updated_email@example.com",
  "phone": "13900139001",
  "status": 0
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
-- æ‰§è¡Œæ›´æ–°åæŸ¥è¯¢
SELECT * FROM user WHERE id = 1;

-- éªŒè¯å­—æ®µå·²æ›´æ–°
-- email: 'updated_email@example.com'
-- phone: '13900139001'
-- status: 0
-- update_time: å·²æ›´æ–°ä¸ºå½“å‰æ—¶é—´
```

---

### 1.7 åˆ é™¤ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `DELETE /api/users/{id}`

**ç¤ºä¾‹**: `DELETE /api/users/1`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
-- æ‰§è¡Œåˆ é™¤åæŸ¥è¯¢ï¼ˆåº”è¯¥æŸ¥ä¸åˆ°æ•°æ®ï¼‰
SELECT * FROM user WHERE id = 1;
```

---

### 1.8 æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨

**è¯·æ±‚è·¯å¾„**: `GET /api/users/check-username?username=testuser001`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT COUNT(*) FROM user WHERE username = 'testuser001';
-- å¦‚æœè¿”å› 0ï¼Œåˆ™ä¸å­˜åœ¨ï¼›è¿”å› 1ï¼Œåˆ™å­˜åœ¨
```

---

## 2. æ¨¡å—ç®¡ç†æ¥å£ (ModuleController)

### 2.1 åˆ›å»ºæ¨¡å—

**è¯·æ±‚è·¯å¾„**: `POST /api/modules`

**è¯·æ±‚ä½“**:
```json
{
  "name": "æ•°æ®æ¥å…¥æ¨¡å—",
  "description": "è´Ÿè´£ä»å¤šä¸ªæ•°æ®æºæ¥å…¥æ•°æ®",
  "status": 1
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
-- åœ¨ MySQL ä¸­æŸ¥è¯¢
USE zaiqing;
SELECT * FROM module_entity WHERE name = 'æ•°æ®æ¥å…¥æ¨¡å—';

-- éªŒè¯å­—æ®µ
-- id: è‡ªåŠ¨ç”Ÿæˆçš„ID
-- name: 'æ•°æ®æ¥å…¥æ¨¡å—'
-- description: 'è´Ÿè´£ä»å¤šä¸ªæ•°æ®æºæ¥å…¥æ•°æ®'
-- status: 1
-- create_time: å½“å‰æ—¶é—´
-- update_time: å½“å‰æ—¶é—´
```

---

### 2.2 æ ¹æ®IDæŸ¥è¯¢æ¨¡å—

**è¯·æ±‚è·¯å¾„**: `GET /api/modules/{id}`

**ç¤ºä¾‹**: `GET /api/modules/1`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM module_entity WHERE id = 1;
```

---

### 2.3 åˆ†é¡µæŸ¥è¯¢æ¨¡å—

**è¯·æ±‚è·¯å¾„**: `GET /api/modules?page=0&size=10&sort=id`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM module_entity ORDER BY id LIMIT 0, 10;
```

---

### 2.4 æ ¹æ®çŠ¶æ€æŸ¥è¯¢æ¨¡å—

**è¯·æ±‚è·¯å¾„**: `GET /api/modules/status/{status}`

**ç¤ºä¾‹**: `GET /api/modules/status/1`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM module_entity WHERE status = 1;
```

---

### 2.5 æ›´æ–°æ¨¡å—

**è¯·æ±‚è·¯å¾„**: `PUT /api/modules/{id}`

**ç¤ºä¾‹**: `PUT /api/modules/1`

**è¯·æ±‚ä½“**:
```json
{
  "name": "æ•°æ®æ¥å…¥æ¨¡å—ï¼ˆå·²æ›´æ–°ï¼‰",
  "description": "æ›´æ–°åçš„æè¿°ä¿¡æ¯",
  "status": 0
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM module_entity WHERE id = 1;
-- éªŒè¯ name, description, status, update_time å·²æ›´æ–°
```

---

### 2.6 åˆ é™¤æ¨¡å—

**è¯·æ±‚è·¯å¾„**: `DELETE /api/modules/{id}`

**ç¤ºä¾‹**: `DELETE /api/modules/1`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM module_entity WHERE id = 1;
-- åº”è¯¥æŸ¥ä¸åˆ°æ•°æ®
```

---

## 3. åŸå§‹æ•°æ®æ¥å£ (RawDataController) - MongoDB

### 3.1 ä¿å­˜åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/raw-data`

**è¯·æ±‚ä½“**:
```json
{
  "moduleId": 1,
  "dataType": "sensor",
  "dataContent": "æ¸©åº¦: 25.5â„ƒ, æ¹¿åº¦: 60%",
  "content": {
    "temperature": 25.5,
    "humidity": 60,
    "location": "å®éªŒå®¤A"
  },
  "source": "ä¼ æ„Ÿå™¨001",
  "version": 1,
  "processed": false
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// åœ¨ MongoDB ä¸­æŸ¥è¯¢
use module_db;
db.raw_data.find({ source: "ä¼ æ„Ÿå™¨001" }).pretty();

// æˆ–è€…æŸ¥è¯¢æœ€æ–°æ’å…¥çš„æ•°æ®
db.raw_data.find().sort({ _id: -1 }).limit(1).pretty();

// éªŒè¯å­—æ®µ
// _id: MongoDB è‡ªåŠ¨ç”Ÿæˆçš„ID
// module_id: 1
// data_type: "sensor"
// data_content: "æ¸©åº¦: 25.5â„ƒ, æ¹¿åº¦: 60%"
// content: { temperature: 25.5, humidity: 60, location: "å®éªŒå®¤A" }
// source: "ä¼ æ„Ÿå™¨001"
// version: 1
// processed: false
// create_time: å½“å‰æ—¶é—´
// update_time: å½“å‰æ—¶é—´
```

---

### 3.2 æ ¹æ®IDæŸ¥è¯¢åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/raw-data/{id}`

**ç¤ºä¾‹**: `GET /api/raw-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
```

---

### 3.3 æ ¹æ®æ•°æ®ç±»å‹æŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/raw-data/type/{dataType}`

**ç¤ºä¾‹**: `GET /api/raw-data/type/sensor`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.find({ data_type: "sensor" }).pretty();
```

---

### 3.4 æŸ¥è¯¢æœªå¤„ç†çš„æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/raw-data/unprocessed`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.find({ processed: false }).pretty();
```

---

### 3.5 æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/raw-data/time-range?start=2025-12-01T00:00:00&end=2025-12-31T23:59:59`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.find({
  create_time: {
    $gte: ISODate("2025-12-01T00:00:00Z"),
    $lte: ISODate("2025-12-31T23:59:59Z")
  }
}).pretty();
```

---

### 3.6 æ ‡è®°æ•°æ®ä¸ºå·²å¤„ç†

**è¯·æ±‚è·¯å¾„**: `PUT /api/raw-data/{id}/processed`

**ç¤ºä¾‹**: `PUT /api/raw-data/507f1f77bcf86cd799439011/processed`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// æ‰§è¡Œæ›´æ–°åæŸ¥è¯¢
db.raw_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });

// éªŒè¯ processed å­—æ®µå·²æ›´æ–°ä¸º true
// processed: true
// update_time: å·²æ›´æ–°ä¸ºå½“å‰æ—¶é—´
```

---

### 3.7 ç»Ÿè®¡æ•°æ®ç±»å‹æ•°é‡

**è¯·æ±‚è·¯å¾„**: `GET /api/raw-data/count/{dataType}`

**ç¤ºä¾‹**: `GET /api/raw-data/count/sensor`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.countDocuments({ data_type: "sensor" });
```

---

## 4. æ¨¡å—ç›¸å…³åŸå§‹æ•°æ®æ¥å£ (ModuleController)

### 4.1 åˆ›å»ºåŸå§‹æ•°æ®ï¼ˆé€šè¿‡æ¨¡å—æ¥å£ï¼‰

**è¯·æ±‚è·¯å¾„**: `POST /api/modules/raw-data`

**è¯·æ±‚ä½“**:
```json
{
  "moduleId": 1,
  "dataType": "weather",
  "dataContent": "å¤©æ°”æ•°æ®",
  "content": {
    "weather": "æ™´å¤©",
    "temperature": 28,
    "windSpeed": 5
  },
  "source": "æ°”è±¡ç«™001",
  "processed": false
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;
db.raw_data.find({ source: "æ°”è±¡ç«™001" }).pretty();
```

---

### 4.2 æ›´æ–°åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `PUT /api/modules/raw-data/{id}`

**ç¤ºä¾‹**: `PUT /api/modules/raw-data/507f1f77bcf86cd799439011`

**è¯·æ±‚ä½“**:
```json
{
  "moduleId": 1,
  "dataType": "weather",
  "dataContent": "æ›´æ–°åçš„å¤©æ°”æ•°æ®",
  "content": {
    "weather": "å¤šäº‘",
    "temperature": 26,
    "windSpeed": 8
  },
  "source": "æ°”è±¡ç«™001",
  "processed": true
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// éªŒè¯æ‰€æœ‰å­—æ®µå·²æ›´æ–°ï¼ŒåŒ…æ‹¬ update_time
```

---

### 4.3 åˆ é™¤åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `DELETE /api/modules/raw-data/{id}`

**ç¤ºä¾‹**: `DELETE /api/modules/raw-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// åº”è¯¥è¿”å› null
```

---

### 4.4 æ ¹æ®æ¨¡å—IDæŸ¥è¯¢åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/modules/{moduleId}/raw-data`

**ç¤ºä¾‹**: `GET /api/modules/1/raw-data`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.raw_data.find({ module_id: 1 }).pretty();
```

---

### 4.5 è·å–ç»„åˆæ•°æ®ï¼ˆæ¨¡å—+åŸå§‹æ•°æ®ï¼‰

**è¯·æ±‚è·¯å¾„**: `GET /api/modules/{moduleId}/combined`

**ç¤ºä¾‹**: `GET /api/modules/1/combined`

**æ•°æ®åº“éªŒè¯**:
```sql
-- MySQL æŸ¥è¯¢æ¨¡å—ä¿¡æ¯
SELECT * FROM module_entity WHERE id = 1;
```

```javascript
-- MongoDB æŸ¥è¯¢åŸå§‹æ•°æ®
db.raw_data.find({ module_id: 1 }).pretty();
```

---

## 5. æ—¥å¿—æ•°æ®æ¥å£ (LogDataController) - MongoDB

### 5.1 åˆ›å»ºæ—¥å¿—æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/log-data`

**è¯·æ±‚ä½“**:
```json
{
  "level": "INFO",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "timestamp": "2025-12-05T16:30:00",
  "metadata": {
    "userId": 1,
    "ip": "192.168.1.100",
    "action": "login"
  }
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;
db.log_data.find({ message: "ç”¨æˆ·ç™»å½•æˆåŠŸ" }).pretty();

// éªŒè¯å­—æ®µ
// _id: MongoDB è‡ªåŠ¨ç”Ÿæˆçš„ID
// level: "INFO"
// message: "ç”¨æˆ·ç™»å½•æˆåŠŸ"
// timestamp: ISODate("2025-12-05T16:30:00Z")
// metadata: { userId: 1, ip: "192.168.1.100", action: "login" }
// create_time: å½“å‰æ—¶é—´
```

---

### 5.2 æ ¹æ®IDæŸ¥è¯¢æ—¥å¿—æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data/{id}`

**ç¤ºä¾‹**: `GET /api/log-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
```

---

### 5.3 æŸ¥è¯¢æ‰€æœ‰æ—¥å¿—æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.find().pretty();
```

---

### 5.4 åˆ†é¡µæŸ¥è¯¢æ—¥å¿—æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data/page?page=0&size=10`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.find().skip(0).limit(10).pretty();
```

---

### 5.5 æ ¹æ®æ—¥å¿—çº§åˆ«æŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data/level/{level}`

**ç¤ºä¾‹**: `GET /api/log-data/level/INFO`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.find({ level: "INFO" }).pretty();
```

---

### 5.6 æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢æ—¥å¿—

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data/time-range?start=2025-12-01T00:00:00&end=2025-12-31T23:59:59`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.find({
  timestamp: {
    $gte: ISODate("2025-12-01T00:00:00Z"),
    $lte: ISODate("2025-12-31T23:59:59Z")
  }
}).pretty();
```

---

### 5.7 åˆ é™¤æ—¥å¿—æ•°æ®

**è¯·æ±‚è·¯å¾„**: `DELETE /api/log-data/{id}`

**ç¤ºä¾‹**: `DELETE /api/log-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// åº”è¯¥è¿”å› null
```

---

### 5.8 ç»Ÿè®¡æ—¥å¿—çº§åˆ«æ•°é‡

**è¯·æ±‚è·¯å¾„**: `GET /api/log-data/count/level/{level}`

**ç¤ºä¾‹**: `GET /api/log-data/count/level/ERROR`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.log_data.countDocuments({ level: "ERROR" });
```

---

## 6. å¤„ç†æ•°æ®æ¥å£ (ProcessedDataController) - MongoDB

### 6.1 åˆ›å»ºå¤„ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/processed-data`

**è¯·æ±‚ä½“**:
```json
{
  "rawDataId": 1,
  "processedContent": {
    "result": "å¤„ç†å®Œæˆ",
    "confidence": 0.95,
    "category": "æ­£å¸¸"
  },
  "processType": "classification",
  "confidenceScore": 0.95,
  "metadata": {
    "processor": "AIæ¨¡å‹v1.0",
    "processTime": "2025-12-05T16:35:00"
  }
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;
db.processed_data.find({ process_type: "classification" }).pretty();

// éªŒè¯å­—æ®µ
// _id: MongoDB è‡ªåŠ¨ç”Ÿæˆçš„ID
// raw_data_id: 1
// processed_content: { result: "å¤„ç†å®Œæˆ", confidence: 0.95, category: "æ­£å¸¸" }
// process_type: "classification"
// confidence_score: 0.95
// metadata: { processor: "AIæ¨¡å‹v1.0", processTime: "2025-12-05T16:35:00" }
// create_time: å½“å‰æ—¶é—´
```

---

### 6.2 æ ¹æ®IDæŸ¥è¯¢å¤„ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/{id}`

**ç¤ºä¾‹**: `GET /api/processed-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
```

---

### 6.3 æŸ¥è¯¢æ‰€æœ‰å¤„ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find().pretty();
```

---

### 6.4 æ ¹æ®å¤„ç†ç±»å‹æŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/type/{processType}`

**ç¤ºä¾‹**: `GET /api/processed-data/type/classification`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find({ process_type: "classification" }).pretty();
```

---

### 6.5 æ ¹æ®åŸå§‹æ•°æ®IDæŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/raw-data/{rawDataId}`

**ç¤ºä¾‹**: `GET /api/processed-data/raw-data/1`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find({ raw_data_id: 1 }).pretty();
```

---

### 6.6 æŸ¥è¯¢æœ€å°ç½®ä¿¡åº¦æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/confidence/min/{minScore}`

**ç¤ºä¾‹**: `GET /api/processed-data/confidence/min/0.8`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find({ confidence_score: { $gt: 0.8 } }).pretty();
```

---

### 6.7 æŸ¥è¯¢ç½®ä¿¡åº¦èŒƒå›´æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/confidence/range?minScore=0.7&maxScore=0.9`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find({
  confidence_score: {
    $gte: 0.7,
    $lte: 0.9
  }
}).pretty();
```

---

### 6.8 æ ¹æ®å­—æ®µæœç´¢

**è¯·æ±‚è·¯å¾„**: `GET /api/processed-data/search/field?field=category&value=æ­£å¸¸`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.find({ "processed_content.category": "æ­£å¸¸" }).pretty();
```

---

### 6.9 æ›´æ–°ç½®ä¿¡åº¦åˆ†æ•°

**è¯·æ±‚è·¯å¾„**: `PUT /api/processed-data/{id}/confidence?confidenceScore=0.98`

**ç¤ºä¾‹**: `PUT /api/processed-data/507f1f77bcf86cd799439011/confidence?confidenceScore=0.98`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// éªŒè¯ confidence_score å·²æ›´æ–°ä¸º 0.98
```

---

### 6.10 åˆ é™¤å¤„ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `DELETE /api/processed-data/{id}`

**ç¤ºä¾‹**: `DELETE /api/processed-data/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.processed_data.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// åº”è¯¥è¿”å› null
```

---

## ğŸ“ æµ‹è¯•å·¥å…·æ¨è

### 1. Postman / Insomnia
- ç”¨äºå‘é€ HTTP è¯·æ±‚å’Œæµ‹è¯•æ¥å£
- æ”¯æŒä¿å­˜è¯·æ±‚é›†åˆå’Œæµ‹è¯•è„šæœ¬

### 2. cURL å‘½ä»¤ç¤ºä¾‹

```bash
# åˆ›å»ºç”¨æˆ·
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","phone":"13800138000","status":1}'

# æŸ¥è¯¢ç”¨æˆ·
curl http://localhost:8080/api/users/1

# åˆ›å»ºåŸå§‹æ•°æ®
curl -X POST http://localhost:8080/api/raw-data \
  -H "Content-Type: application/json" \
  -d '{"moduleId":1,"dataType":"sensor","dataContent":"æµ‹è¯•æ•°æ®","source":"æµ‹è¯•æº","processed":false}'
```

### 3. æ•°æ®åº“æŸ¥è¯¢å·¥å…·
- **MySQL**: MySQL Workbench, Navicat, DBeaver
- **MongoDB**: MongoDB Compass, Studio 3T, Robo 3T

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### MySQL æ•°æ®åº“ (zaiqing)
- [ ] `user` è¡¨ï¼šæµ‹è¯•ç”¨æˆ·å¢åˆ æ”¹æŸ¥
- [ ] `module_entity` è¡¨ï¼šæµ‹è¯•æ¨¡å—å¢åˆ æ”¹æŸ¥

### MongoDB æ•°æ®åº“ (module_db)
- [ ] `raw_data` é›†åˆï¼šæµ‹è¯•åŸå§‹æ•°æ®æ“ä½œ
- [ ] `log_data` é›†åˆï¼šæµ‹è¯•æ—¥å¿—æ•°æ®æ“ä½œ
- [ ] `processed_data` é›†åˆï¼šæµ‹è¯•å¤„ç†æ•°æ®æ“ä½œ

---

## ğŸ” å¸¸è§é—®é¢˜

1. **æ—¶é—´æ ¼å¼**ï¼šæ‰€æœ‰æ—¶é—´å­—æ®µåœ¨ MongoDB ä¸­å­˜å‚¨ä¸º ISODate æ ¼å¼
2. **ID æ ¼å¼**ï¼š
   - MySQL: è‡ªå¢ Long ç±»å‹
   - MongoDB: ObjectId å­—ç¬¦ä¸²
3. **å­—æ®µæ˜ å°„**ï¼šJava é©¼å³°å‘½åè½¬æ¢ä¸ºæ•°æ®åº“ä¸‹åˆ’çº¿å‘½åï¼ˆå¦‚ `moduleId` â†’ `module_id`ï¼‰

---

## 7. æ–‡ä»¶ç®¡ç†æ¥å£ (FileController) - MongoDB GridFS

### 7.1 ä¸Šä¼ æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `POST /api/files/upload`

**è¯·æ±‚æ–¹å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
- `file` (å¿…éœ€): æ–‡ä»¶
- `fileType` (å¿…éœ€): æ–‡ä»¶ç±»å‹ (image, audio, video, document)
- `relatedDataId` (å¯é€‰): å…³è”çš„æ•°æ®ID
- `relatedDataType` (å¯é€‰): å…³è”çš„æ•°æ®ç±»å‹
- `userId` (å¯é€‰): ä¸Šä¼ ç”¨æˆ·ID
- `description` (å¯é€‰): æ–‡ä»¶æè¿°

**ç¤ºä¾‹ (cURL)**:
```bash
curl -X POST http://localhost:8080/api/files/upload \
  -F "file=@/path/to/image.jpg" \
  -F "fileType=image" \
  -F "description=æµ‹è¯•å›¾ç‰‡" \
  -F "userId=1"
```

**ç¤ºä¾‹ (Postman)**:
- Method: POST
- URL: `http://localhost:8080/api/files/upload`
- Body: form-data
  - file: [é€‰æ‹©æ–‡ä»¶]
  - fileType: image
  - description: æµ‹è¯•å›¾ç‰‡
  - userId: 1

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;

// æŸ¥è¯¢æ–‡ä»¶å…ƒæ•°æ®
db.file_metadata.find().sort({ create_time: -1 }).limit(1).pretty();

// éªŒè¯å­—æ®µ
// _id: MongoDB è‡ªåŠ¨ç”Ÿæˆçš„ID
// grid_fs_id: GridFS æ–‡ä»¶ID
// file_name: å”¯ä¸€æ–‡ä»¶å
// original_name: åŸå§‹æ–‡ä»¶å
// file_type: "image"
// mime_type: "image/jpeg"
// file_size: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
// file_extension: "jpg"
// description: "æµ‹è¯•å›¾ç‰‡"
// upload_user_id: 1
// status: 1
// create_time: å½“å‰æ—¶é—´
// update_time: å½“å‰æ—¶é—´

// æŸ¥è¯¢ GridFS æ–‡ä»¶
db.fs.files.find().sort({ uploadDate: -1 }).limit(1).pretty();
```

---

### 7.2 æ ¹æ®IDæŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯

**è¯·æ±‚è·¯å¾„**: `GET /api/files/{id}`

**ç¤ºä¾‹**: `GET /api/files/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
```

---

### 7.3 æŸ¥è¯¢æ‰€æœ‰æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `GET /api/files`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.find({ status: 1 }).pretty();
```

---

### 7.4 æ ¹æ®æ–‡ä»¶ç±»å‹æŸ¥è¯¢

**è¯·æ±‚è·¯å¾„**: `GET /api/files/type/{fileType}`

**ç¤ºä¾‹**: `GET /api/files/type/image`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.find({ file_type: "image", status: 1 }).pretty();
```

---

### 7.5 æ ¹æ®å…³è”æ•°æ®æŸ¥è¯¢æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `GET /api/files/related?relatedDataId={id}&relatedDataType={type}`

**ç¤ºä¾‹**: `GET /api/files/related?relatedDataId=1&relatedDataType=raw_data`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.find({ 
  related_data_id: "1", 
  related_data_type: "raw_data",
  status: 1 
}).pretty();
```

---

### 7.6 æŸ¥è¯¢ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `GET /api/files/user/{userId}`

**ç¤ºä¾‹**: `GET /api/files/user/1`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.find({ upload_user_id: 1, status: 1 }).pretty();
```

---

### 7.7 ä¸‹è½½æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `GET /api/files/{id}/download`

**ç¤ºä¾‹**: `GET /api/files/507f1f77bcf86cd799439011/download`

**å“åº”**: æ–‡ä»¶äºŒè¿›åˆ¶æµï¼ŒContent-Type ä¸ºæ–‡ä»¶ MIME ç±»å‹ï¼ŒContent-Disposition ä¸º attachment

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// éªŒè¯æ–‡ä»¶å…ƒæ•°æ®å­˜åœ¨
db.file_metadata.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });

// éªŒè¯ GridFS æ–‡ä»¶å­˜åœ¨
db.fs.files.findOne({ _id: ObjectId("<grid_fs_id>") });
```

---

### 7.8 é¢„è§ˆæ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `GET /api/files/{id}/preview`

**ç¤ºä¾‹**: `GET /api/files/507f1f77bcf86cd799439011/preview`

**è¯´æ˜**: 
- æ”¯æŒé¢„è§ˆçš„æ–‡ä»¶ç±»å‹ï¼šå›¾ç‰‡ (jpg, png, gif, bmp, webp)ã€æ–‡æœ¬æ–‡ä»¶ã€PDF
- å“åº”å¤´ Content-Disposition ä¸º inlineï¼Œæµè§ˆå™¨ç›´æ¥æ˜¾ç¤ºè€Œéä¸‹è½½

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// éªŒè¯æ–‡ä»¶å…ƒæ•°æ®
const file = db.file_metadata.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// éªŒè¯ mime_type æ˜¯å¦æ”¯æŒé¢„è§ˆ
// æ”¯æŒçš„ MIME ç±»å‹: image/*, text/*, application/pdf
```

---

### 7.9 è®¿é—®æ–‡ä»¶ï¼ˆç›´æ¥è®¿é—®ï¼‰

**è¯·æ±‚è·¯å¾„**: `GET /api/files/{id}/access`

**ç¤ºä¾‹**: `GET /api/files/507f1f77bcf86cd799439011/access`

**è¯´æ˜**: ä¸ä¸‹è½½æ¥å£ç±»ä¼¼ï¼Œä½† Content-Disposition ä¸º inlineï¼Œé€‚åˆåœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ˜¾ç¤º

---

### 7.10 è·å–æ–‡ä»¶è®¿é—®URL

**è¯·æ±‚è·¯å¾„**: `GET /api/files/{id}/url`

**ç¤ºä¾‹**: `GET /api/files/507f1f77bcf86cd799439011/url`

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": "/api/files/access/507f1f77bcf86cd799439011"
}
```

---

### 7.11 æ›´æ–°æ–‡ä»¶ä¿¡æ¯

**è¯·æ±‚è·¯å¾„**: `PUT /api/files/{id}`

**ç¤ºä¾‹**: `PUT /api/files/507f1f77bcf86cd799439011`

**è¯·æ±‚å‚æ•°**:
- `description` (å¯é€‰): æ–‡ä»¶æè¿°
- `accessLevel` (å¯é€‰): è®¿é—®çº§åˆ« (0-å…¬å¼€, 1-å†…éƒ¨, 2-ç§æœ‰)

**ç¤ºä¾‹ (cURL)**:
```bash
curl -X PUT "http://localhost:8080/api/files/507f1f77bcf86cd799439011?description=æ›´æ–°åçš„æè¿°&accessLevel=0"
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
db.file_metadata.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// éªŒè¯ description å’Œ access_level å·²æ›´æ–°
// éªŒè¯ update_time å·²æ›´æ–°ä¸ºå½“å‰æ—¶é—´
```

---

### 7.12 åˆ é™¤æ–‡ä»¶

**è¯·æ±‚è·¯å¾„**: `DELETE /api/files/{id}`

**ç¤ºä¾‹**: `DELETE /api/files/507f1f77bcf86cd799439011`

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// éªŒè¯æ–‡ä»¶çŠ¶æ€å·²æ›´æ–°ä¸º 0ï¼ˆå·²åˆ é™¤ï¼‰
db.file_metadata.findOne({ _id: ObjectId("507f1f77bcf86cd799439011") });
// status: 0

// éªŒè¯ GridFS æ–‡ä»¶å·²åˆ é™¤ï¼ˆå¦‚æœå®ç°ï¼‰
db.fs.files.findOne({ _id: ObjectId("<grid_fs_id>") });
// åº”è¯¥è¿”å› null
```

---

### 7.13 è·å–æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚è·¯å¾„**: `GET /api/files/statistics`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalFiles": 100,
    "totalSize": 104857600,
    "typeCount": {
      "image": 50,
      "document": 30,
      "video": 15,
      "audio": 5
    },
    "typeSize": {
      "image": 52428800,
      "document": 31457280,
      "video": 15728640,
      "audio": 5242880
    }
  }
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// ç»Ÿè®¡æ€»æ–‡ä»¶æ•°
db.file_metadata.countDocuments({ status: 1 });

// ç»Ÿè®¡æ€»å¤§å°
db.file_metadata.aggregate([
  { $match: { status: 1 } },
  { $group: { _id: null, totalSize: { $sum: "$file_size" } } }
]);

// æŒ‰ç±»å‹ç»Ÿè®¡
db.file_metadata.aggregate([
  { $match: { status: 1 } },
  { $group: { 
      _id: "$file_type", 
      count: { $sum: 1 },
      totalSize: { $sum: "$file_size" }
    }
  }
]);
```

---

## 8. ç”¨æˆ·ç®¡ç†æ¥å£ - ä¸­æ–‡æ”¯æŒæµ‹è¯•

### 8.1 åˆ›å»ºä¸­æ–‡ç”¨æˆ·åç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `POST /api/users`

**è¯·æ±‚ä½“**:
```json
{
  "username": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "phone": "13800138001",
  "status": 1
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
USE zaiqing;
SELECT * FROM user WHERE username = 'å¼ ä¸‰';

-- éªŒè¯ä¸­æ–‡æ­£ç¡®å­˜å‚¨
-- username: 'å¼ ä¸‰' (UTF-8 ç¼–ç )
-- å­—ç¬¦é›†åº”ä¸º utf8mb4
```

---

### 8.2 åˆ›å»ºåŒ…å«ä¸­æ–‡æè¿°çš„ç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `POST /api/users`

**è¯·æ±‚ä½“**:
```json
{
  "username": "testuser002",
  "email": "testuser002@example.com",
  "phone": "13800138002",
  "status": 1
}
```

**è¯´æ˜**: è™½ç„¶ç”¨æˆ·å®ä½“æ²¡æœ‰ description å­—æ®µï¼Œä½†å¯ä»¥éªŒè¯å…¶ä»–æ¥å£çš„ä¸­æ–‡æ”¯æŒ

---

### 8.3 æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å«ä¸­æ–‡ï¼‰

**è¯·æ±‚è·¯å¾„**: `PUT /api/users/{id}`

**ç¤ºä¾‹**: `PUT /api/users/1`

**è¯·æ±‚ä½“**:
```json
{
  "username": "æå››",
  "email": "lisi@example.com",
  "phone": "13900139001",
  "status": 1
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM user WHERE id = 1;
-- éªŒè¯ username å·²æ›´æ–°ä¸º 'æå››'
-- éªŒè¯ä¸­æ–‡æ­£ç¡®å­˜å‚¨å’Œæ˜¾ç¤º
```

---

### 8.4 æŸ¥è¯¢ä¸­æ–‡ç”¨æˆ·åç”¨æˆ·

**è¯·æ±‚è·¯å¾„**: `GET /api/users/username/{username}`

**ç¤ºä¾‹**: `GET /api/users/username/å¼ ä¸‰`

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
SELECT * FROM user WHERE username = 'å¼ ä¸‰';
-- éªŒè¯èƒ½æ­£ç¡®æŸ¥è¯¢åˆ°ä¸­æ–‡ç”¨æˆ·å
```

---

### 8.5 æ–‡ä»¶ä¸Šä¼ ï¼ˆä¸­æ–‡æ–‡ä»¶åå’Œæè¿°ï¼‰

**è¯·æ±‚è·¯å¾„**: `POST /api/files/upload`

**è¯·æ±‚å‚æ•°**:
- `file`: æ–‡ä»¶ï¼ˆæ–‡ä»¶ååŒ…å«ä¸­æ–‡ï¼Œå¦‚ï¼šæµ‹è¯•å›¾ç‰‡.jpgï¼‰
- `fileType`: image
- `description`: è¿™æ˜¯æµ‹è¯•å›¾ç‰‡çš„æè¿°ä¿¡æ¯

**ç¤ºä¾‹ (cURL)**:
```bash
curl -X POST http://localhost:8080/api/files/upload \
  -F "file=@æµ‹è¯•å›¾ç‰‡.jpg" \
  -F "fileType=image" \
  -F "description=è¿™æ˜¯æµ‹è¯•å›¾ç‰‡çš„æè¿°ä¿¡æ¯" \
  -F "userId=1"
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;

// æŸ¥è¯¢æœ€æ–°ä¸Šä¼ çš„æ–‡ä»¶
db.file_metadata.find().sort({ create_time: -1 }).limit(1).pretty();

// éªŒè¯å­—æ®µ
// original_name: "æµ‹è¯•å›¾ç‰‡.jpg" (ä¸­æ–‡æ–‡ä»¶åæ­£ç¡®å­˜å‚¨)
// description: "è¿™æ˜¯æµ‹è¯•å›¾ç‰‡çš„æè¿°ä¿¡æ¯" (ä¸­æ–‡æè¿°æ­£ç¡®å­˜å‚¨)
```

---

## ğŸ“ æ–‡ä»¶å­˜å‚¨è¯´æ˜

### MongoDB GridFS å­˜å‚¨

æ–‡ä»¶ç³»ç»Ÿå·²è¿ç§»åˆ° MongoDB GridFSï¼š

1. **æ–‡ä»¶å†…å®¹**: å­˜å‚¨åœ¨ MongoDB GridFS (`fs.files` å’Œ `fs.chunks` é›†åˆ)
2. **æ–‡ä»¶å…ƒæ•°æ®**: å­˜å‚¨åœ¨ MongoDB `file_metadata` é›†åˆ
3. **ä¼˜åŠ¿**:
   - æ”¯æŒå¤§æ–‡ä»¶å­˜å‚¨ï¼ˆ>16MBï¼‰
   - æ–‡ä»¶å†…å®¹ä¸å…ƒæ•°æ®ç»Ÿä¸€ç®¡ç†
   - æ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨
   - è‡ªåŠ¨åˆ†ç‰‡å­˜å‚¨

### æ–‡ä»¶è®¿é—®æ–¹å¼

- **ä¸‹è½½**: `/api/files/{id}/download` - å¼ºåˆ¶ä¸‹è½½
- **é¢„è§ˆ**: `/api/files/{id}/preview` - æµè§ˆå™¨å†…é¢„è§ˆï¼ˆæ”¯æŒå›¾ç‰‡ã€æ–‡æœ¬ã€PDFï¼‰
- **è®¿é—®**: `/api/files/{id}/access` - ç›´æ¥è®¿é—®ï¼ˆinline æ¨¡å¼ï¼‰

---

## 9. æ•°æ®å¯è§†åŒ–æ¥å£ (DashboardController)

### 9.1 è·å–å›¾è¡¨æ•°æ®

**è¯·æ±‚è·¯å¾„**: `GET /api/dashboard/charts`

**è¯·æ±‚æ–¹æ³•**: `GET`

**é¢„æœŸç»“æœ**: è¿”å›åŒ…å«å„ç§å›¾è¡¨æ•°æ®çš„å¯¹è±¡
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dataTypeDistribution": {
      "labels": ["sensor", "weather", "unknown"],
      "values": [10, 5, 2],
      "total": 17
    },
    "trendChart": {
      "dates": ["2025-12-11", "2025-12-12", ...],
      "rawData": [5, 3, 2, ...],
      "processedData": [2, 1, 1, ...],
      "days": 7
    },
    "sourceDistribution": {
      "ä¸šåŠ¡æŠ¥é€": 10,
      "æ³›åœ¨æ„ŸçŸ¥": 5,
      "æœªçŸ¥": 2
    },
    "processStatusDistribution": {
      "å·²å¤„ç†": 12,
      "æœªå¤„ç†": 5
    }
  }
}
```

**æ•°æ®åº“éªŒè¯**: æ— éœ€éªŒè¯ï¼Œè¿™æ˜¯ç»Ÿè®¡æŸ¥è¯¢æ¥å£

---

### 9.2 è·å–æ•°æ®ç±»å‹åˆ†å¸ƒå›¾è¡¨ï¼ˆé¥¼å›¾ï¼‰

**è¯·æ±‚è·¯å¾„**: `GET /api/dashboard/charts/data-type-distribution`

**è¯·æ±‚æ–¹æ³•**: `GET`

**é¢„æœŸç»“æœ**: è¿”å›æ•°æ®ç±»å‹åˆ†å¸ƒæ•°æ®ï¼Œç”¨äºç»˜åˆ¶é¥¼å›¾
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "labels": ["sensor", "weather", "unknown"],
    "values": [10, 5, 2],
    "total": 17
  }
}
```

**è¯´æ˜**: 
- `labels`: æ•°æ®ç±»å‹åˆ—è¡¨
- `values`: å¯¹åº”ç±»å‹çš„æ•°é‡
- `total`: æ€»æ•°æ®é‡

---

### 9.3 è·å–æ•°æ®è¶‹åŠ¿å›¾è¡¨ï¼ˆæŠ˜çº¿å›¾ï¼‰

**è¯·æ±‚è·¯å¾„**: `GET /api/dashboard/charts/trend?days=7`

**è¯·æ±‚æ–¹æ³•**: `GET`

**è¯·æ±‚å‚æ•°**:
- `days` (å¯é€‰): æŸ¥è¯¢å¤©æ•°ï¼Œé»˜è®¤7å¤©

**ç¤ºä¾‹**: `GET /api/dashboard/charts/trend?days=30`

**é¢„æœŸç»“æœ**: è¿”å›è¶‹åŠ¿æ•°æ®ï¼Œç”¨äºç»˜åˆ¶æŠ˜çº¿å›¾
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dates": ["2025-12-11", "2025-12-12", "2025-12-13", ...],
    "rawData": [5, 3, 2, 4, 1, 3, 2],
    "processedData": [2, 1, 1, 2, 0, 1, 1],
    "days": 7
  }
}
```

**è¯´æ˜**:
- `dates`: æ—¥æœŸåˆ—è¡¨ï¼ˆæœ€è¿‘Nå¤©ï¼‰
- `rawData`: æ¯å¤©åŸå§‹æ•°æ®æ•°é‡
- `processedData`: æ¯å¤©å¤„ç†æ•°æ®æ•°é‡
- `days`: æŸ¥è¯¢å¤©æ•°

---

## 10. å­˜å‚¨ç­–ç•¥ç®¡ç†æ¥å£ (StorageStrategyController)

### 10.1 åˆ›å»ºå­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `POST /api/storage-strategy`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯·æ±‚ä½“**:
```json
{
  "strategyName": "åŸå§‹æ•°æ®é»˜è®¤ç­–ç•¥",
  "dataType": "sensor",
  "storageType": "mongodb",
  "retentionDays": 30,
  "maxSize": 1073741824,
  "cleanupRule": "{\"autoClean\": true, \"cleanupTime\": \"02:00\"}",
  "status": 1
}
```

**å­—æ®µè¯´æ˜**:
- `strategyName`: ç­–ç•¥åç§°ï¼ˆå¿…å¡«ï¼‰
- `dataType`: é€‚ç”¨çš„æ•°æ®ç±»å‹ï¼ˆå¯é€‰ï¼‰
- `storageType`: å­˜å‚¨ç±»å‹ï¼Œå¦‚ mongodbã€mysqlï¼ˆå¯é€‰ï¼‰
- `retentionDays`: ä¿ç•™å¤©æ•°ï¼ˆå¯é€‰ï¼‰
- `maxSize`: æœ€å¤§å­˜å‚¨å¤§å°ï¼Œå•ä½å­—èŠ‚ï¼ˆå¯é€‰ï¼‰
- `cleanupRule`: æ¸…ç†è§„åˆ™ï¼ŒJSONæ ¼å¼ï¼ˆå¯é€‰ï¼‰
- `status`: çŠ¶æ€ï¼Œ0-ç¦ç”¨ï¼Œ1-å¯ç”¨ï¼ˆé»˜è®¤1ï¼‰

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "å­˜å‚¨ç­–ç•¥åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "strategyName": "åŸå§‹æ•°æ®é»˜è®¤ç­–ç•¥",
    "dataType": "sensor",
    "storageType": "mongodb",
    "retentionDays": 30,
    "maxSize": 1073741824,
    "cleanupRule": "{\"autoClean\": true, \"cleanupTime\": \"02:00\"}",
    "status": 1,
    "createTime": "2025-12-18T10:00:00",
    "updateTime": "2025-12-18T10:00:00"
  }
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
USE zaiqing;
SELECT * FROM storage_strategy WHERE strategy_name = 'åŸå§‹æ•°æ®é»˜è®¤ç­–ç•¥';
```

---

### 10.2 æŸ¥è¯¢æ‰€æœ‰å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `GET /api/storage-strategy`

**è¯·æ±‚æ–¹æ³•**: `GET`

**é¢„æœŸç»“æœ**: è¿”å›æ‰€æœ‰å­˜å‚¨ç­–ç•¥åˆ—è¡¨

---

### 10.3 æ ¹æ®IDæŸ¥è¯¢å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `GET /api/storage-strategy/{id}`

**ç¤ºä¾‹**: `GET /api/storage-strategy/1`

**é¢„æœŸç»“æœ**: è¿”å›æŒ‡å®šIDçš„å­˜å‚¨ç­–ç•¥

---

### 10.4 æ ¹æ®æ•°æ®ç±»å‹æŸ¥è¯¢å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `GET /api/storage-strategy/data-type/{dataType}`

**ç¤ºä¾‹**: `GET /api/storage-strategy/data-type/sensor`

**é¢„æœŸç»“æœ**: è¿”å›è¯¥æ•°æ®ç±»å‹çš„æ‰€æœ‰å­˜å‚¨ç­–ç•¥

---

### 10.5 æŸ¥è¯¢å¯ç”¨çš„å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `GET /api/storage-strategy/active`

**é¢„æœŸç»“æœ**: è¿”å›æ‰€æœ‰çŠ¶æ€ä¸ºå¯ç”¨ï¼ˆstatus=1ï¼‰çš„å­˜å‚¨ç­–ç•¥

---

### 10.6 æ›´æ–°å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `PUT /api/storage-strategy/{id}`

**ç¤ºä¾‹**: `PUT /api/storage-strategy/1`

**è¯·æ±‚ä½“**:
```json
{
  "strategyName": "åŸå§‹æ•°æ®é»˜è®¤ç­–ç•¥ï¼ˆæ›´æ–°ï¼‰",
  "retentionDays": 60,
  "status": 1
}
```

**é¢„æœŸç»“æœ**: è¿”å›æ›´æ–°åçš„å­˜å‚¨ç­–ç•¥

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
USE zaiqing;
SELECT * FROM storage_strategy WHERE id = 1;
-- éªŒè¯ retention_days å·²æ›´æ–°ä¸º 60
```

---

### 10.7 åˆ é™¤å­˜å‚¨ç­–ç•¥

**è¯·æ±‚è·¯å¾„**: `DELETE /api/storage-strategy/{id}`

**ç¤ºä¾‹**: `DELETE /api/storage-strategy/1`

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "å­˜å‚¨ç­–ç•¥åˆ é™¤æˆåŠŸ",
  "data": null
}
```

**æ•°æ®åº“éªŒè¯ (MySQL)**:
```sql
USE zaiqing;
SELECT * FROM storage_strategy WHERE id = 1;
-- åº”è¯¥æŸ¥è¯¢ä¸åˆ°ç»“æœ
```

---

## 11. æ•°æ®æ·˜æ±°æ¥å£ (DataEvictionController)

### 11.1 æ¸…ç†è¿‡æœŸçš„åŸå§‹æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/data-eviction/raw-data`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯´æ˜**: æ¸…ç†æ‰€æœ‰å·²è¿‡æœŸçš„åŸå§‹æ•°æ®ï¼ˆæ ¹æ® expireTime æˆ– retentionDaysï¼‰

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "æ¸…ç†å®Œæˆ",
  "data": 5
}
```

**è¯´æ˜**: `data` å­—æ®µè¡¨ç¤ºåˆ é™¤çš„æ•°æ®æ¡æ•°

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
// åœ¨ MongoDB ä¸­æŸ¥è¯¢
use module_db;
db.raw_data.find({});
// éªŒè¯è¿‡æœŸæ•°æ®å·²è¢«åˆ é™¤
```

---

### 11.2 æ¸…ç†è¿‡æœŸçš„å¤„ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/data-eviction/processed-data`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯´æ˜**: æ¸…ç†æ‰€æœ‰å·²è¿‡æœŸçš„å¤„ç†æ•°æ®

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "æ¸…ç†å®Œæˆ",
  "data": 3
}
```

**æ•°æ®åº“éªŒè¯ (MongoDB)**:
```javascript
use module_db;
db.processed_data.find({});
// éªŒè¯è¿‡æœŸæ•°æ®å·²è¢«åˆ é™¤
```

---

### 11.3 æ¸…ç†æ‰€æœ‰è¿‡æœŸæ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/data-eviction/all`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯´æ˜**: åŒæ—¶æ¸…ç†è¿‡æœŸçš„åŸå§‹æ•°æ®å’Œå¤„ç†æ•°æ®

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "æ¸…ç†å®Œæˆ",
  "data": 8
}
```

**è¯´æ˜**: `data` å­—æ®µè¡¨ç¤ºæ€»å…±åˆ é™¤çš„æ•°æ®æ¡æ•°ï¼ˆåŸå§‹æ•°æ® + å¤„ç†æ•°æ®ï¼‰

---

### 11.4 æ ¹æ®å­˜å‚¨ç­–ç•¥æ¸…ç†æ•°æ®

**è¯·æ±‚è·¯å¾„**: `POST /api/data-eviction/strategy/{dataType}`

**ç¤ºä¾‹**: `POST /api/data-eviction/strategy/sensor`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯´æ˜**: æ ¹æ®æŒ‡å®šæ•°æ®ç±»å‹çš„å­˜å‚¨ç­–ç•¥æ¸…ç†æ•°æ®

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "æ¸…ç†å®Œæˆ",
  "data": 10
}
```

**æ•°æ®åº“éªŒè¯**:
1. å…ˆæŸ¥è¯¢è¯¥æ•°æ®ç±»å‹çš„å­˜å‚¨ç­–ç•¥ï¼ˆMySQLï¼‰:
```sql
USE zaiqing;
SELECT * FROM storage_strategy WHERE data_type = 'sensor';
```

2. éªŒè¯ MongoDB ä¸­è¯¥ç±»å‹çš„æ•°æ®æ˜¯å¦æŒ‰ç­–ç•¥æ¸…ç†:
```javascript
use module_db;
db.raw_data.find({data_type: "sensor"});
```

---

### 11.5 å®šæ—¶ä»»åŠ¡è¯´æ˜

**è¯´æ˜**: ç³»ç»Ÿå·²é…ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ‰§è¡Œæ•°æ®æ¸…ç†

**é…ç½®ä½ç½®**: `ScheduledTaskConfig.java`

**Cronè¡¨è¾¾å¼**: `0 0 2 * * ?` (æ¯å¤©å‡Œæ™¨2ç‚¹)

**æ—¥å¿—éªŒè¯**: æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š
```
å¼€å§‹æ‰§è¡Œå®šæ—¶æ•°æ®æ¸…ç†ä»»åŠ¡...
æ¸…ç†è¿‡æœŸåŸå§‹æ•°æ®å®Œæˆï¼Œå…±åˆ é™¤ X æ¡
æ¸…ç†è¿‡æœŸå¤„ç†æ•°æ®å®Œæˆï¼Œå…±åˆ é™¤ Y æ¡
å®šæ—¶æ•°æ®æ¸…ç†ä»»åŠ¡æ‰§è¡Œå®Œæˆ
```

---

## ğŸ“ æ•°æ®æ—¶æ•ˆæ€§ç®¡ç†è¯´æ˜

### æ•°æ®æ—¶æ•ˆæ€§å­—æ®µ

**åŸå§‹æ•°æ® (RawData)** å’Œ **å¤„ç†æ•°æ® (ProcessedData)** å·²æ·»åŠ ä»¥ä¸‹å­—æ®µï¼š

1. **expireTime** (LocalDateTime): æ•°æ®è¿‡æœŸæ—¶é—´
   - å¦‚æœè®¾ç½®äº†æ­¤å­—æ®µï¼Œç³»ç»Ÿä¼šåœ¨è¿‡æœŸåè‡ªåŠ¨æ¸…ç†

2. **retentionDays** (Integer): ä¿ç•™å¤©æ•°
   - å¦‚æœæœªè®¾ç½® expireTimeï¼Œç³»ç»Ÿä¼šæ ¹æ® createTime + retentionDays è®¡ç®—è¿‡æœŸæ—¶é—´

### æ•°æ®æ·˜æ±°è§„åˆ™

1. **ä¼˜å…ˆä½¿ç”¨ expireTime**: å¦‚æœè®¾ç½®äº† expireTimeï¼Œç›´æ¥ä½¿ç”¨è¯¥æ—¶é—´åˆ¤æ–­æ˜¯å¦è¿‡æœŸ
2. **ä½¿ç”¨ retentionDays**: å¦‚æœæœªè®¾ç½® expireTime ä½†è®¾ç½®äº† retentionDaysï¼Œåˆ™æ ¹æ® createTime + retentionDays è®¡ç®—
3. **å­˜å‚¨ç­–ç•¥**: å¦‚æœæ•°æ®æœªè®¾ç½®æ—¶æ•ˆæ€§å­—æ®µï¼Œå¯ä»¥é…ç½®å­˜å‚¨ç­–ç•¥ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç­–ç•¥æ¸…ç†

### ä½¿ç”¨ç¤ºä¾‹

**åˆ›å»ºå¸¦æ—¶æ•ˆæ€§çš„åŸå§‹æ•°æ®**:
```json
{
  "dataType": "sensor",
  "dataContent": "æ¸©åº¦: 25Â°C",
  "source": "ä¸šåŠ¡æŠ¥é€",
  "retentionDays": 30
}
```

ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®— `expireTime = createTime + 30å¤©`

---

